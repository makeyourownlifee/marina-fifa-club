<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marina FIFA Club</title>
  <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .glow:hover {
      box-shadow: 0 0 10px rgba(236, 72, 153, 0.5);
    }
    .page-bg {
      background-image: url('https://w0.peakpx.com/wallpaper/355/120/HD-wallpaper-champions-league-icio-uefa-champions-league.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
    }
    @media (max-width: 640px) {
      .mb-mobile {
        margin-bottom: 4rem;
      }
      .modal-content {
        max-height: 80vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
    }
  </style>
</head>
<body class="bg-gray-900">
  <div id="root"></div>
  <script type="text/javascript">
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};
    function filledCell(cell) {
      return cell !== '' && cell != null;
    }
    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
          try {
              var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
              var firstSheetName = workbook.SheetNames[0];
              var worksheet = workbook.Sheets[firstSheetName];
              var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
              var filteredData = jsonData.filter(row => row.some(filledCell));
              var headerRowIndex = filteredData.findIndex((row, index) =>
                row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
              );
              if (headerRowIndex === -1 || headerRowIndex > 25) {
                headerRowIndex = 0;
              }
              var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
              csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
              return csv;
          } catch (e) {
              console.error(e);
              return "";
          }
      }
      return gk_fileData[filename] || "";
    }

    const { useState, useEffect } = React;

    const initialPlayers = [
      { id: 1, name: "Mell", avatar: null },
      { id: 2, name: "Bazsi", avatar: null },
      { id: 3, name: "Peti", avatar: null },
      { id: 4, name: "Lacus", avatar: null },
      { id: 5, name: "Benyó", avatar: null },
      { id: 6, name: "B-imi", avatar: null },
    ];

    const initialTeams = [
      // English Premier League (20 teams)
      "Arsenal", "Aston Villa", "Bournemouth", "Brentford", "Brighton & Hove Albion",
      "Chelsea", "Crystal Palace", "Everton", "Fulham", "Ipswich Town",
      "Leicester City", "Liverpool", "Manchester City", "Manchester United",
      "Newcastle United", "Nottingham Forest", "Southampton", "Tottenham Hotspur",
      "West Ham United", "Wolverhampton Wanderers",
      // Spanish La Liga (20 teams)
      "Alavés", "Athletic Club", "Atlético Madrid", "Barcelona", "Celta Vigo",
      "Deportivo Alavés", "Getafe", "Girona", "Las Palmas", "Leganés",
      "Mallorca", "Osasuna", "Rayo Vallecano", "Real Betis", "Real Madrid",
      "Real Sociedad", "Sevilla", "Valencia", "Valladolid", "Villarreal",
      // German Bundesliga (18 teams)
      "Augsburg", "Bayern Munich", "Borussia Dortmund", "Borussia Mönchengladbach",
      "Eintracht Frankfurt", "Freiburg", "Heidenheim", "Hoffenheim",
      "Holstein Kiel", "Mainz", "RB Leipzig", "St. Pauli", "Stuttgart",
      "Union Berlin", "Werder Bremen", "Wolfsburg", "Bochum", "Köln", "Bayer Leverkusen",
      // French Ligue 1 (18 teams)
      "Angers", "Auxerre", "Brest", "Le Havre", "Lens",
      "Lille", "Lyon", "Marseille", "Monaco", "Montpellier",
      "Nantes", "Nice", "Paris Saint-Germain", "Reims", "Rennes",
      "Saint-Étienne", "Strasbourg", "Toulouse",
      // Italian Serie A (20 teams)
      "AC Milan", "Atalanta", "Bologna", "Cagliari", "Como",
      "Empoli", "Fiorentina", "Genoa", "Hellas Verona", "Inter Milan",
      "Juventus", "Lazio", "Lecce", "Monza", "Napoli",
      "Parma", "Roma", "Sampdoria", "Torino", "Udinese",
      // FIFA World Rankings Top 50 National Teams (as of September 2024, adjusted for 2025 trends)
      "Argentina", "France", "Spain", "England", "Brazil",
      "Belgium", "Portugal", "Netherlands", "Italy", "Croatia",
      "Colombia", "Uruguay", "Germany", "Mexico", "USA",
      "Switzerland", "Morocco", "Japan", "Senegal", "Denmark",
      "Iran", "South Korea", "Poland", "Algeria", "Serbia",
      "Chile", "Nigeria", "Austria", "Ukraine", "Egypt",
      "Peru", "Sweden", "Czech Republic", "Norway", "Ghana",
      "Turkey", "Cameroon", "Greece", "Wales", "Tunisia",
      "Ivory Coast", "Hungary", "Scotland", "Romania", "Venezuela",
      "Paraguay", "Finland", "Slovakia", "Iraq"
    ].filter((team, index, self) => self.indexOf(team) === index); // Remove duplicates

    const shuffleArray = (array) => {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    };

    const generateTournament = (players) => {
      const matches = [];
      const shuffledPlayers = shuffleArray([...players]);
      const numPlayers = players.length;

      if (numPlayers === 5) {
        const pairs = [
          [[0, 1], [2, 3]],
          [[0, 2], [1, 4]],
          [[0, 3], [1, 4]],
          [[0, 4], [2, 3]],
          [[1, 3], [2, 4]],
        ];
        pairs.forEach(([team1, team2], index) => {
          matches.push({
            id: `match-5p-${index}-${Date.now()}`,
            team1: [shuffledPlayers[team1[0]], shuffledPlayers[team1[1]]],
            team2: [shuffledPlayers[team2[0]], shuffledPlayers[team2[1]]],
            goals: { team1: "", team2: "" },
            team1Club: "",
            team2Club: "",
            resting: shuffledPlayers[4 - index % 5],
            confirmed: false,
          });
        });
      } else if (numPlayers === 4) {
        const pairs = [
          [[0, 1], [2, 3]],
          [[0, 2], [1, 3]],
          [[0, 3], [1, 2]],
          [[1, 2], [0, 3]],
          [[1, 3], [0, 2]],
          [[2, 3], [0, 1]],
        ];
        pairs.forEach(([team1, team2], index) => {
          matches.push({
            id: `match-4p-${index}-${Date.now()}`,
            team1: [shuffledPlayers[team1[0]], shuffledPlayers[team1[1]]],
            team2: [shuffledPlayers[team2[0]], shuffledPlayers[team2[1]]],
            goals: { team1: "", team2: "" },
            team1Club: "",
            team2Club: "",
            resting: null,
            confirmed: false,
          });
        });
      }
      return matches;
    };

    const calculateTopTeams = (tournaments) => {
      const teamStats = {};
      tournaments.forEach(tournament => {
        tournament.matches.forEach(match => {
          if (match.team1Club && match.goals.team1 !== "" && match.goals.team2 !== "") {
            if (!teamStats[match.team1Club]) {
              teamStats[match.team1Club] = { matches: 0, wins: 0, goals: 0 };
            }
            teamStats[match.team1Club].matches += 1;
            teamStats[match.team1Club].goals += parseInt(match.goals.team1) || 0;
            if (parseInt(match.goals.team1) > parseInt(match.goals.team2)) {
              teamStats[match.team1Club].wins += 1;
            }
          }
          if (match.team2Club && match.goals.team1 !== "" && match.goals.team2 !== "") {
            if (!teamStats[match.team2Club]) {
              teamStats[match.team2Club] = { matches: 0, wins: 0, goals: 0 };
            }
            teamStats[match.team2Club].matches += 1;
            teamStats[match.team2Club].goals += parseInt(match.goals.team2) || 0;
            if (parseInt(match.goals.team2) > parseInt(match.goals.team1)) {
              teamStats[match.team2Club].wins += 1;
            }
          }
        });
      });

      const topTeams = Object.keys(teamStats)
        .map(team => ({
          name: team,
          matches: teamStats[team].matches,
          wins: teamStats[team].wins,
          winRate: (teamStats[team].wins / teamStats[team].matches) * 100,
          xG: teamStats[team].goals / teamStats[team].matches,
        }))
        .filter(team => teamStats[team.name].matches >= 1)
        .sort((a, b) => b.winRate - a.winRate)
        .slice(0, 10);

      return topTeams;
    };

    const NavBar = ({ setCurrentPage, currentPage }) => {
      const handleNavClick = (page) => {
        try {
          console.log("Nav clicked, setting page to:", page);
          setCurrentPage(page);
          window.location.hash = page;
        } catch (error) {
          console.error("Error in handleNavClick:", error);
        }
      };

      return React.createElement(
        "nav",
        { className: "fixed bottom-0 w-full bg-gray-800 bg-opacity-90 text-white flex justify-around py-4 shadow-lg" },
        [
          React.createElement(
            "a",
            {
              key: "nav-home",
              href: "#home",
              onClick: () => handleNavClick("home"),
              className: `flex items-center transition-all ${currentPage === "home" ? "border-b-2 border-pink-500 text-pink-500" : "text-pink-500 hover:text-pink-400"}`
            },
            React.createElement(
              "svg",
              { className: `w-6 h-6 ${currentPage === "home" ? "text-pink-500" : "text-pink-500"}`, fill: "currentColor", viewBox: "0 0 20 20" },
              React.createElement("path", { d: "M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001 1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" })
            )
          ),
          React.createElement(
            "a",
            {
              key: "nav-players",
              href: "#players",
              onClick: () => handleNavClick("players"),
              className: `flex items-center transition-all ${currentPage === "players" ? "border-b-2 border-pink-500 text-pink-500" : "text-pink-500 hover:text-pink-400"}`
            },
            React.createElement(
              "svg",
              { className: `w-6 h-6 ${currentPage === "players" ? "text-pink-500" : "text-pink-500"}`, fill: "currentColor", viewBox: "0 0 20 20" },
              React.createElement("path", { d: "M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" })
            )
          ),
          React.createElement(
            "a",
            {
              key: "nav-generate",
              href: "#generate",
              onClick: () => handleNavClick("generate"),
              className: `flex items-center transition-all ${currentPage === "generate" ? "border-b-2 border-pink-500 text-pink-500 shadow-[0_0_5px_rgba(236,72,153,0.5)]" : "text-pink-500 hover:text-pink-400"}`
            },
            React.createElement(
              "svg",
              { className: `w-6 h-6 ${currentPage === "generate" ? "text-pink-500" : "text-pink-500"}`, fill: "currentColor", viewBox: "0 0 24 24" },
              React.createElement("path", { d: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" })
            )
          ),
          React.createElement(
            "a",
            {
              key: "nav-dicegame",
              href: "#dicegame",
              onClick: () => handleNavClick("dicegame"),
              className: `flex items-center transition-all ${currentPage === "dicegame" ? "border-b-2 border-pink-500 text-pink-500" : "text-pink-500 hover:text-pink-400"}`
            },
            React.createElement(
              "svg",
              { className: `w-6 h-6 ${currentPage === "dicegame" ? "text-pink-500" : "text-pink-500"}`, fill: "currentColor", viewBox: "0 0 20 20" },
              React.createElement("path", { d: "M3 3h14v14H3V3zm2 2v10h10V5H5zm2 2h2v2H7V7zm0 4h2v2H7v-2zm4-4h2v2h-2V7zm0 4h2v2h-2v-2zm4-4h2v2h-2V7z" })
            )
          ),
          React.createElement(
            "a",
            {
              key: "nav-stats",
              href: "#stats",
              onClick: () => handleNavClick("stats"),
              className: `flex items-center transition-all ${currentPage === "stats" ? "border-b-2 border-pink-500 text-pink-500" : "text-pink-500 hover:text-pink-400"}`
            },
            React.createElement(
              "svg",
              { className: `w-6 h-6 ${currentPage === "stats" ? "text-pink-500" : "text-pink-500"}`, fill: "currentColor", viewBox: "0 0 20 20" },
              React.createElement("path", { d: "M2 3h16v2H2V3zm0 4h4v10H2V7zm6 0h4v10H8V7zm6 0h4v10h-4V7z" })
            )
          ),
          React.createElement(
            "a",
            {
              key: "nav-rounds",
              href: "#rounds",
              onClick: () => handleNavClick("rounds"),
              className: `flex items-center transition-all ${currentPage === "rounds" ? "border-b-2 border-pink-500 text-pink-500" : "text-pink-500 hover:text-pink-400"}`
            },
            React.createElement(
              "svg",
              { className: `w-6 h-6 ${currentPage === "rounds" ? "text-pink-500" : "text-pink-500"}`, fill: "currentColor", viewBox: "0 0 20 20" },
              React.createElement("path", { d: "M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" })
            )
          ),
        ]
      );
    };

    const Home = ({ tournaments }) => {
      const topTeams = calculateTopTeams(tournaments);

      return React.createElement(
        "div",
        { className: "p-4 max-w-full mx-auto fade-in page-bg" },
        React.createElement(
          "div",
          { className: "bg-gray-900 bg-opacity-75 p-6 rounded-2xl" },
          [
            React.createElement("img", {
              src: "https://i.imgur.com/nOKFXli.png",
              alt: "Marina FIFA Club Logo",
              className: "w-48 h-48 mx-auto mt-4 sm:w-40 sm:h-40 fade-in",
              style: { objectFit: "contain" }
            }),
            React.createElement("h1", { className: "text-4xl font-bold text-white text-center mt-4" }, "Marina FIFA Club"),
            React.createElement("p", { className: "text-center mt-6 text-gray-400 text-lg font-light" }, "Üdv a bajnokság appban! Generálj egy új bajnokságot, vagy játssz egy kockajátékot!"),
            React.createElement(
              "div",
              { className: "mt-8" },
              [
                topTeams.length > 0 ? React.createElement(
                "div",
                { className: "mt-4 grid grid-cols-4 gap-2 text-gray-400 text-sm" },
                [
                  React.createElement("span", { className: "font-bold" }, "Csapat"),
                  React.createElement("span", { className: "font-bold text-center" }, "M"),
                  React.createElement("span", { className: "font-bold text-center" }, "W"),
                  React.createElement("span", { className: "font-bold text-center" }, "xG"),
                  ...topTeams.flatMap((team, index) => [
                    React.createElement("span", { key: `team-${index}-name`, className: "text-white" }, team.name),
                    React.createElement("span", { key: `team-${index}-matches`, className: "text-center text-pink-500 font-bold" }, team.matches),
                    React.createElement("span", { key: `team-${index}-wins`, className: "text-center text-pink-500 font-bold" }, 
                      `${team.wins} (${team.winRate.toFixed(1)}%)`
                    ),
                    React.createElement("span", { key: `team-${index}-xg`, className: "text-center" }, team.xG.toFixed(2)),
                  ]),
                ]
              ) : React.createElement("p", { className: "mt-4 text-gray-400" }, "Még nincs elég adat a statisztikához. Játssz néhány meccset!")              ]
            ),
          ]
        )
      );
    };

    const Players = ({ players, setPlayers, addPlayer, teams, addCustomTeam }) => {
      const [newPlayerName, setNewPlayerName] = useState("");
      const [customTeam, setCustomTeam] = useState("");
      const [editPlayer, setEditPlayer] = useState(null);
      const [editName, setEditName] = useState("");
      const [editAvatar, setEditAvatar] = useState("");

      const handleAddPlayer = () => {
        if (newPlayerName.trim()) {
          addPlayer({
            id: players.length + 1,
            name: newPlayerName,
            avatar: null,
          });
          setNewPlayerName("");
        }
      };

      const handleAddCustomTeam = () => {
        if (customTeam.trim() && !teams.includes(customTeam.trim())) {
          addCustomTeam(customTeam.trim());
          setCustomTeam("");
        }
      };

      const handleEditPlayer = (player) => {
        setEditPlayer(player);
        setEditName(player.name);
        setEditAvatar(player.avatar || "");
      };

      const handleSaveEdit = () => {
        if (editName.trim()) {
          setPlayers(players.map(p =>
            p.id === editPlayer.id ? { ...p, name: editName, avatar: editAvatar || null } : p
          ));
          setEditPlayer(null);
          setEditName("");
          setEditAvatar("");
        }
      };

      const handleCloseEdit = () => {
        setEditPlayer(null);
        setEditName("");
        setEditAvatar("");
      };

      return React.createElement(
        "div",
        { className: "p-4 max-w-full mx-auto fade-in page-bg" },
        [
          React.createElement(
            "div",
            { className: "bg-gray-900 bg-opacity-75 p-6 rounded-2xl mb-mobile" },
            [
              React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Játékosok"),
              React.createElement(
                "div",
                { className: "grid grid-cols-1 gap-4 mt-6" },
                players.map(player =>
                  React.createElement(
                    "div",
                    {
                      key: `player-${player.id}`,
                      className: "flex items-center bg-gray-800 bg-opacity-80 p-4 rounded-2xl border border-pink-500 glow transition-all cursor-pointer",
                      onClick: () => handleEditPlayer(player)
                    },
                    [
                      player.avatar ? 
                        React.createElement("img", {
                          src: player.avatar,
                          alt: `${player.name} avatar`,
                          className: "w-12 h-12 rounded-full mr-4 object-cover"
                        }) :
                        React.createElement(
                          "div",
                          { className: "w-12 h-12 rounded-full bg-pink-500 flex items-center justify-center mr-4 text-white text-lg font-bold" },
                          player.name.charAt(0).toUpperCase()
                        ),
                      React.createElement("span", { className: "text-white font-medium text-lg" }, player.name),
                    ]
                  )
                )
              ),
              React.createElement(
                "div",
                { className: "mt-6" },
                [
                  React.createElement("input", {
                    type: "text",
                    value: newPlayerName,
                    onChange: (e) => setNewPlayerName(e.target.value),
                    placeholder: "Új játékos neve",
                    className: "border border-gray-600 bg-gray-800 text-white p-3 rounded-2xl w-full focus:outline-none focus:ring-2 focus:ring-pink-500",
                  }),
                  React.createElement(
                    "button",
                    {
                      onClick: handleAddPlayer,
                      className: "mt-4 bg-gray-200 text-gray-800 p-3 rounded-2xl w-full hover:bg-gray-100 active:scale-95 transition-all glow"
                    },
                    "Játékos hozzáadása"
                  ),
                ]
              ),
              React.createElement(
                "div",
                { className: "mt-6" },
                [
                  React.createElement("h3", { className: "text-xl font-bold text-white" }, "Egyedi csapat hozzáadása"),
                  React.createElement("input", {
                    type: "text",
                    value: customTeam,
                    onChange: (e) => setCustomTeam(e.target.value),
                    placeholder: "Egyedi csapat neve (pl. Adiddas XI)",
                    className: "border border-gray-600 bg-gray-800 text-white p-3 rounded-2xl w-full focus:outline-none focus:ring-2 focus:ring-pink-500",
                  }),
                  React.createElement(
                    "button",
                    {
                      onClick: handleAddCustomTeam,
                      disabled: !customTeam.trim(),
                      className: "mt-4 bg-pink-500 text-white p-3 rounded-2xl w-full hover:bg-pink-400 active:scale-95 transition-all glow disabled:bg-gray-600"
                    },
                    "Egyedi csapat mentése"
                  ),
                ]
              ),
            ]
          ),
          editPlayer && React.createElement(
            "div",
            { className: "fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4" },
            React.createElement(
              "div",
              { className: "bg-gray-900 p-6 rounded-2xl w-full max-w-lg modal-content" },
              [
                React.createElement(
                  "button",
                  {
                    onClick: handleCloseEdit,
                    className: "absolute top-2 right-2 text-white text-2xl"
                  },
                  "✕"
                ),
                React.createElement("h3", { className: "text-2xl font-bold text-white" }, "Játékos szerkesztése"),
                React.createElement(
                  "div",
                  { className: "mt-4 space-y-4" },
                  [
                    React.createElement("input", {
                      type: "text",
                      value: editName,
                      onChange: (e) => setEditName(e.target.value),
                      placeholder: "Játékos neve",
                      className: "border border-gray-600 bg-gray-800 text-white p-3 rounded-2xl w-full focus:outline-none focus:ring-2 focus:ring-pink-500",
                    }),
                    React.createElement("input", {
                      type: "text",
                      value: editAvatar,
                      onChange: (e) => setEditAvatar(e.target.value),
                      placeholder: "Avatar URL (pl. https://i.imgur.com/xyz.png)",
                      className: "border border-gray-600 bg-gray-800 text-white p-3 rounded-2xl w-full focus:outline-none focus:ring-2 focus:ring-pink-500",
                    }),
                    editAvatar && React.createElement("img", {
                      src: editAvatar,
                      alt: "Avatar előnézet",
                      className: "w-24 h-24 rounded-full mx-auto mt-4 object-cover"
                    }),
                    React.createElement(
                      "button",
                      {
                        onClick: handleSaveEdit,
                        className: "bg-pink-500 text-white p-3 rounded-2xl w-full hover:bg-pink-400 active:scale-95 transition-all glow"
                      },
                      "Mentés"
                    ),
                  ]
                ),
              ]
            )
          ),
        ]
      );
    };

    const DiceGame = ({ players, addDiceGame }) => {
      const [selectedPlayers, setSelectedPlayers] = useState([]);
      const [isTie, setIsTie] = useState(false);

      const handlePlayerSelect = (playerId) => {
        if (selectedPlayers.includes(playerId)) {
          setSelectedPlayers(selectedPlayers.filter(id => id !== playerId));
        } else {
          setSelectedPlayers([...selectedPlayers, playerId]);
        }
      };

      const handleCloseGame = async () => {
        if (selectedPlayers.length >= 2) {
          const results = selectedPlayers.map((playerId, index) => {
            let position = getPlayerPosition(playerId);
            return { playerId, position };
          });
          try {
            const response = await fetch('/api/diceGames', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ timestamp: new Date().toISOString(), results }),
            });
            if (response.ok) {
              addDiceGame({ timestamp: new Date().toISOString(), results });
              setSelectedPlayers([]);
              setIsTie(false);
            } else {
              console.error('Failed to save dice game');
            }
          } catch (error) {
            console.error('Error saving dice game:', error);
          }
        }
      };

      const getPlayerPosition = (playerId) => {
        const index = selectedPlayers.indexOf(playerId);
        if (index === -1) return null;
        if (isTie && index < 2) return 1;
        return index + 1;
      };

      return React.createElement(
        "div",
        { className: "p-4 max-w-full mx-auto fade-in page-bg" },
        [
          React.createElement(
            "div",
            { className: "bg-gray-900 bg-opacity-75 p-6 rounded-2xl mb-mobile" },
            [
              React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Kockajáték"),
              React.createElement(
                "button",
                {
                  onClick: () => setIsTie(!isTie),
                  className: `mt-6 px-4 py-2 rounded-2xl ${isTie ? "bg-pink-500 text-white" : "bg-gray-200 text-gray-800"} hover:bg-pink-400 active:scale-95 transition-all glow`
                },
                "DÖNTETLEN"
              ),
              React.createElement(
                "div",
                { className: "mt-6 grid grid-cols-2 gap-2" },
                players.map(player =>
                  React.createElement(
                    "button",
                    {
                      key: `player-select-${player.id}`,
                      onClick: () => handlePlayerSelect(player.id),
                      className: `px-4 py-2 rounded-2xl text-white flex items-center justify-between ${selectedPlayers.includes(player.id) ? "bg-pink-500" : "bg-gray-800"} hover:bg-pink-400 active:scale-95 transition-all glow`
                    },
                    [
                      React.createElement("span", { key: `player-name-${player.id}` }, player.name),
                      selectedPlayers.includes(player.id) && React.createElement(
                        "span",
                        { key: `player-position-${player.id}`, className: "text-white font-bold" },
                        getPlayerPosition(player.id)
                      ),
                    ]
                  )
                )
              ),
              React.createElement(
                "button",
                {
                  onClick: handleCloseGame,
                  disabled: selectedPlayers.length < 2,
                  className: "mt-8 bg-pink-500 text-white p-3 rounded-2xl w-full hover:bg-pink-400 active:scale-95 transition-all glow disabled:bg-gray-600"
                },
                "LEZÁRÁS"
              ),
            ]
          ),
        ]
      );
    };

    const GenerateTournament = ({ players, addTournament, teams }) => {
      const [mode, setMode] = useState(5);
      const [selectedPlayers, setSelectedPlayers] = useState([]);
      const [matches, setMatches] = useState(JSON.parse(localStorage.getItem('tournament-draft')) || []);
      const [teamSearch, setTeamSearch] = useState({});
      const [showSuggestions, setShowSuggestions] = useState({});

      useEffect(() => {
        const fetchDraft = async () => {
          try {
            const response = await fetch('/api/temp-tournaments');
            if (response.ok) {
              const draft = await response.json();
              if (draft.matches && draft.matches.length > 0 && matches.length === 0) {
                setMatches(draft.matches);
              }
            }
          } catch (error) {
            console.error('Error fetching draft:', error);
          }
        };
        fetchDraft();
      }, []);

      useEffect(() => {
        localStorage.setItem('tournament-draft', JSON.stringify(matches));
      }, [matches]);

      const handlePlayerToggle = (playerId) => {
        if (selectedPlayers.includes(playerId)) {
          setSelectedPlayers(selectedPlayers.filter(id => id !== playerId));
        } else if (selectedPlayers.length < mode) {
          setSelectedPlayers([...selectedPlayers, playerId]);
        }
      };

      const handleGenerate = () => {
        if (selectedPlayers.length === mode) {
          const tournamentPlayers = players.filter(p => selectedPlayers.includes(p.id));
          const generatedMatches = generateTournament(tournamentPlayers);
          setMatches(generatedMatches);
        }
      };

      const handleConfirmMatch = (matchId) => {
        setMatches(matches.map(match =>
          match.id === matchId && match.goals.team1 !== "" && match.goals.team2 !== ""
            ? { ...match, confirmed: !match.confirmed }
            : match
        ));
      };

      const handleSaveDraft = async () => {
        try {
          const response = await fetch('/api/temp-tournaments', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ matches, timestamp: new Date().toISOString() }),
          });
          if (response.ok) {
            alert('Vázlat mentve!');
          } else {
            console.error('Failed to save draft');
          }
        } catch (error) {
          console.error('Error saving draft:', error);
        }
      };

      const handleCloseTournament = async () => {
        if (matches.length > 0) {
          try {
            const response = await fetch('/api/tournaments', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ matches, timestamp: new Date().toISOString() }),
            });
            if (response.ok) {
              addTournament({ matches, timestamp: new Date().toISOString() });
              setMatches([]);
              setSelectedPlayers([]);
              localStorage.removeItem('tournament-draft');
              await fetch('/api/temp-tournaments', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
              });
            } else {
              console.error('Failed to save tournament');
            }
          } catch (error) {
            console.error('Error saving tournament:', error);
          }
        }
      };

      const handleTeamSearch = (matchId, team, value) => {
        setTeamSearch({ ...teamSearch, [`${matchId}-${team}`]: value });
        setShowSuggestions({ ...showSuggestions, [`${matchId}-${team}`]: value !== "" });
        if (value === "") {
          setMatches(matches.map(match =>
            match.id === matchId ? { ...match, [team]: "" } : match
          ));
        }
      };

      const selectTeam = (matchId, team, selectedTeam) => {
        setMatches(matches.map(match =>
          match.id === matchId
            ? { ...match, [team]: selectedTeam }
            : match
        ));
        setTeamSearch({ ...teamSearch, [`${matchId}-${team}`]: selectedTeam });
        setShowSuggestions({ ...showSuggestions, [`${matchId}-${team}`]: false });
      };

      const canGenerate = matches.length === 0 || !matches.some(match => match.goals.team1 !== "" || match.goals.team2 !== "");

      return React.createElement(
        "div",
        { className: "p-4 max-w-full mx-auto fade-in page-bg" },
        [
          React.createElement(
            "div",
            { className: "bg-gray-900 bg-opacity-75 p-6 rounded-2xl mb-mobile" },
            [
              React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Bajnokság Generálás"),
              React.createElement(
                "div",
                { className: "flex gap-4 mt-6" },
                [
                  React.createElement(
                    "button",
                    {
                      onClick: () => setMode(5),
                      className: `px-4 py-2 rounded-2xl ${mode === 5 ? "bg-pink-500 text-white" : "bg-gray-200 text-gray-800"} hover:bg-pink-400 active:scale-95 transition-all glow`
                    },
                    "5-játékos"
                  ),
                  React.createElement(
                    "button",
                    {
                      onClick: () => setMode(4),
                      className: `px-4 py-2 rounded-2xl ${mode === 4 ? "bg-pink-500 text-white" : "bg-gray-200 text-gray-800"} hover:bg-pink-400 active:scale-95 transition-all glow`
                    },
                    "4-játékos"
                  ),
                ]
              ),
              React.createElement(
                "div",
                { className: "mt-6 grid grid-cols-2 gap-2" },
                players.map(player =>
                  React.createElement(
                    "button",
                    {
                      key: `player-select-${player.id}`,
                      onClick: () => handlePlayerToggle(player.id),
                      disabled: !selectedPlayers.includes(player.id) && selectedPlayers.length >= mode,
                      className: `px-4 py-2 rounded-2xl text-white ${selectedPlayers.includes(player.id) ? "bg-pink-500" : "bg-gray-800"} hover:bg-pink-400 active:scale-95 transition-all glow disabled:bg-gray-600`
                    },
                    player.name
                  )
                )
              ),
              React.createElement(
                "button",
                {
                  onClick: handleGenerate,
                  disabled: selectedPlayers.length !== mode || !canGenerate,
                  className: "mt-6 bg-pink-500 text-white p-3 rounded-2xl w-full hover:bg-pink-400 active:scale-95 transition-all glow disabled:bg-gray-600"
                },
                "KEZDÉS"
              ),
              matches.length > 0 && React.createElement(
                "button",
                {
                  onClick: handleSaveDraft,
                  className: "mt-4 bg-gray-200 text-gray-800 p-3 rounded-2xl w-full hover:bg-gray-100 active:scale-95 transition-all glow"
                },
                "Mentés vázlatként"
              ),
              React.createElement(
                "div",
                { className: "mt-8 space-y-6" },
                matches.map((match, index) =>
                  React.createElement(
                    "div",
                    { key: match.id, className: "bg-gray-800 bg-opacity-80 p-4 rounded-2xl border border-pink-500 glow transition-all" },
                    [
                      React.createElement("h3", { className: "text-gray-400 text-sm text-center font-medium" }, `#${index + 1}`),
                      React.createElement(
                        "div",
                        { className: "flex flex-col sm:flex-row justify-between items-center mt-4 space-y-4 sm:space-y-0 sm:space-x-4" },
                        [
                          React.createElement(
                            "div",
                            { className: "flex-1 min-w-0 max-w-[120px] flex flex-col items-start" },
                            [
                              React.createElement(
                                "span",
                                { className: "text-white font-medium text-sm border border-pink-500 rounded-full px-2 py-1 truncate" },
                                `${match.team1[0].name} + ${match.team1[1].name}`
                              ),
                              React.createElement(
                                "div",
                                { className: "relative w-full mt-2" },
                                [
                                  React.createElement("input", {
                                    type: "text",
                                    value: teamSearch[`${match.id}-team1Club`] || match.team1Club || "",
                                    onChange: (e) => handleTeamSearch(match.id, "team1Club", e.target.value),
                                    placeholder: "Csapat keresése...",
                                    className: "border border-gray-600 bg-gray-800 text-white p-2 rounded-2xl w-full text-sm focus:outline-none focus:ring-2 focus:ring-pink-500"
                                  }),
                                  showSuggestions[`${match.id}-team1Club`] && React.createElement(
                                    "div",
                                    { className: "absolute z-10 bg-gray-800 border border-gray-600 rounded-2xl mt-1 w-full max-h-40 overflow-y-auto" },
                                    teams
                                      .filter(team => team.toLowerCase().includes((teamSearch[`${match.id}-team1Club`] || "").toLowerCase()))
                                      .slice(0, 5)
                                      .map(team =>
                                        React.createElement(
                                          "div",
                                          {
                                            key: `${match.id}-team1-club-${team}`,
                                            onClick: () => selectTeam(match.id, "team1Club", team),
                                            className: "p-2 text-white text-sm hover:bg-pink-500 cursor-pointer"
                                          },
                                          team
                                        )
                                      )
                                  ),
                                ]
                              ),
                            ]
                          ),
                          React.createElement(
                            "div",
                            { className: "flex flex-col items-center" },
                            [
                              React.createElement(
                                "div",
                                { className: "flex justify-center items-center" },
                                [
                                  React.createElement("input", {
                                    type: "number",
                                    inputMode: "numeric",
                                    value: match.goals.team1,
                                    onChange: (e) => {
                                      match.goals.team1 = e.target.value;
                                      setMatches([...matches]);
                                    },
                                    className: "border border-gray-600 bg-gray-800 text-white p-2 rounded-2xl w-20 h-12 text-4xl text-center"
                                  }),
                                  React.createElement("div", { className: "text-gray-400 font-bold mx-2 text-lg" }, "vs"),
                                  React.createElement("input", {
                                    type: "number",
                                    inputMode: "numeric",
                                    value: match.goals.team2,
                                    onChange: (e) => {
                                      match.goals.team2 = e.target.value;
                                      setMatches([...matches]);
                                    },
                                    className: "border border-gray-600 bg-gray-800 text-white p-2 rounded-2xl w-20 h-12 text-4xl text-center"
                                  }),
                                ]
                              ),
                              React.createElement(
                                "span",
                                {
                                  onClick: () => handleConfirmMatch(match.id),
                                  className: `mt-2 text-lg cursor-pointer ${match.confirmed && match.goals.team1 !== "" && match.goals.team2 !== "" ? "text-green-500" : "text-gray-500"}`
                                },
                                match.confirmed && match.goals.team1 !== "" && match.goals.team2 !== "" ? "✅" : "☑️"
                              ),
                            ]
                          ),
                          React.createElement(
                            "div",
                            { className: "flex-1 min-w-0 max-w-[120px] flex flex-col items-end" },
                            [
                              React.createElement(
                                "span",
                                { className: "text-white font-medium text-sm border border-pink-500 rounded-full px-2 py-1 truncate" },
                                `${match.team2[0].name} + ${match.team2[1].name}`
                              ),
                              React.createElement(
                                "div",
                                { className: "relative w-full mt-2" },
                                [
                                  React.createElement("input", {
                                    type: "text",
                                    value: teamSearch[`${match.id}-team2Club`] || match.team2Club || "",
                                    onChange: (e) => handleTeamSearch(match.id, "team2Club", e.target.value),
                                    placeholder: "Csapat keresése...",
                                    className: "border border-gray-600 bg-gray-800 text-white p-2 rounded-2xl w-full text-sm focus:outline-none focus:ring-2 focus:ring-pink-500"
                                  }),
                                  showSuggestions[`${match.id}-team2Club`] && React.createElement(
                                    "div",
                                    { className: "absolute z-10 bg-gray-800 border border-gray-600 rounded-2xl mt-1 w-full max-h-40 overflow-y-auto" },
                                    teams
                                      .filter(team => team.toLowerCase().includes((teamSearch[`${match.id}-team2Club`] || "").toLowerCase()))
                                      .slice(0, 5)
                                      .map(team =>
                                        React.createElement(
                                          "div",
                                          {
                                            key: `${match.id}-team2-club-${team}`,
                                            onClick: () => selectTeam(match.id, "team2Club", team),
                                            className: "p-2 text-white text-sm hover:bg-pink-500 cursor-pointer"
                                          },
                                          team
                                        )
                                      )
                                  ),
                                ]
                              ),
                            ]
                          ),
                        ]
                      ),
                      match.resting && React.createElement(
                        "p",
                        { className: "text-gray-400 text-sm mt-4 text-center" },
                        `😴 Pihen: ${match.resting.name}`
                      ),
                    ]
                  )
                )
              ),
              matches.length > 0 && React.createElement(
                "button",
                {
                  onClick: handleCloseTournament,
                  className: "mt-8 bg-pink-500 text-white p-3 rounded-2xl w-full hover:bg-pink-400 active:scale-95 transition-all glow"
                },
                "LEZÁRÁS"
              ),
            ]
          ),
        ]
      );
    };

    const Rounds = ({ tournaments, diceGames, players, setTournaments, teams }) => { // teams prop hozzáadva
  const [viewMode, setViewMode] = useState("fifa");
  const calculateSerialNumbers = (items) => {
    const sortedByDate = [...items].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
    return sortedByDate.map((item, index) => ({ item, serial: index + 1 }));
  };
  const tournamentSerialMap = {};
  calculateSerialNumbers(tournaments).forEach(({ item, serial }) => {
    tournamentSerialMap[item.timestamp] = serial;
  });
  const diceGameSerialMap = {};
  calculateSerialNumbers(diceGames).forEach(({ item, serial }) => {
    diceGameSerialMap[item.timestamp] = serial;
  });
  const [selectedTournament, setSelectedTournament] = useState(null);
  const [selectedDiceGame, setSelectedDiceGame] = useState(null);
  const [scrollPosition, setScrollPosition] = useState(0);
  const [editModes, setEditModes] = useState({});

  // Új állapotok a kereséshez (minden meccs külön keresőmezővel rendelkezik)
  const [teamSearch, setTeamSearch] = useState({});
  const [showSuggestions, setShowSuggestions] = useState({});

  const calculatePlayerStats = (matches) => {
    const stats = {};
    matches.forEach(match => {
      const team1Players = match.team1.map(p => p.id);
      const team2Players = match.team2.map(p => p.id);
      const goals1 = parseInt(match.goals.team1) || 0;
      const goals2 = parseInt(match.goals.team2) || 0;
      team1Players.forEach(playerId => {
        if (!stats[playerId]) stats[playerId] = { wins: 0, goalsScored: 0, goalsConceded: 0 };
        stats[playerId].goalsScored += goals1;
        stats[playerId].goalsConceded += goals2;
        if (goals1 > goals2) stats[playerId].wins += 1;
      });
      team2Players.forEach(playerId => {
        if (!stats[playerId]) stats[playerId] = { wins: 0, goalsScored: 0, goalsConceded: 0 };
        stats[playerId].goalsScored += goals2;
        stats[playerId].goalsConceded += goals1;
        if (goals2 > goals1) stats[playerId].wins += 1;
      });
    });
    return Object.keys(stats).map(playerId => ({
      player: players.find(p => p.id === parseInt(playerId)),
      wins: stats[playerId].wins,
      goalsScored: stats[playerId].goalsScored,
      goalsConceded: stats[playerId].goalsConceded,
      goalDifference: stats[playerId].goalsScored - stats[playerId].goalsConceded,
    })).sort((a, b) => (b.wins !== a.wins ? b.wins - a.wins : b.goalDifference - a.goalDifference));
  };

  const handleOpenModal = (item, type) => {
    setScrollPosition(window.scrollY);
    if (type === "tournament") setSelectedTournament(item);
    else setSelectedDiceGame(item);
  };

  const handleCloseModal = () => {
    fetch('/api/tournaments')
      .then(response => response.json())
      .then(data => {
        setTournaments(data);
        setSelectedTournament(null);
        setSelectedDiceGame(null);
        window.scrollTo(0, scrollPosition);
      })
      .catch(console.error);
  };

  const sortedTournaments = [...tournaments].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
  const sortedDiceGames = [...diceGames].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

  // Szűrőlogika a csapatokhoz
  const handleTeamSearch = (matchId, team, value) => {
    setTeamSearch({ ...teamSearch, [`${matchId}-${team}`]: value });
    setShowSuggestions({ ...showSuggestions, [`${matchId}-${team}`]: value !== "" });
    if (value === "") {
      const updatedMatches = [...selectedTournament.matches];
      const matchIndex = updatedMatches.findIndex(match => match.id === matchId);
      updatedMatches[matchIndex] = { ...updatedMatches[matchIndex], [team]: "" };
      setSelectedTournament({ ...selectedTournament, matches: updatedMatches });
    }
  };

  const selectTeam = (matchId, team, selectedTeam) => {
    const updatedMatches = [...selectedTournament.matches];
    const matchIndex = updatedMatches.findIndex(match => match.id === matchId);
    updatedMatches[matchIndex] = { ...updatedMatches[matchIndex], [team]: selectedTeam };
    setSelectedTournament({ ...selectedTournament, matches: updatedMatches });
    setTeamSearch({ ...teamSearch, [`${matchId}-${team}`]: selectedTeam });
    setShowSuggestions({ ...showSuggestions, [`${matchId}-${team}`]: false });
  };

  return React.createElement(
    "div",
    { className: "p-4 max-w-full mx-auto fade-in page-bg" },
    [
      React.createElement(
        "div",
        { className: "bg-gray-900 bg-opacity-75 p-6 rounded-2xl" },
        [
          React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Archív"),
          React.createElement(
            "div",
            { className: "flex gap-4 mt-6" },
            [
              React.createElement(
                "button",
                {
                  onClick: () => setViewMode("fifa"),
                  className: `px-4 py-2 rounded-2xl ${viewMode === "fifa" ? "bg-pink-500 text-white" : "bg-gray-200 text-gray-800"} hover:bg-pink-400 active:scale-95 transition-all glow`
                },
                "🎮 FIFA"
              ),
              React.createElement(
                "button",
                {
                  onClick: () => setViewMode("dice"),
                  className: `px-4 py-2 rounded-2xl ${viewMode === "dice" ? "bg-pink-500 text-white" : "bg-gray-200 text-gray-800"} hover:bg-pink-400 active:scale-95 transition-all glow`
                },
                "🎲 DICE"
              ),
            ]
          ),
          React.createElement(
            "div",
            { className: "mt-6 space-y-4" },
            viewMode === "fifa" ? sortedTournaments.map((tournament, index) =>
              React.createElement(
                "div",
                {
                  key: `tournament-${index}`,
                  className: "bg-gray-800 bg-opacity-80 p-4 rounded-2xl border border-pink-500 glow transition-all cursor-pointer",
                  onClick: () => handleOpenModal(tournament, "tournament")
                },
                React.createElement("p", { className: "text-gray-400" }, 
                  React.createElement("span", { className: "text-white font-bold" }, `#${tournamentSerialMap[tournament.timestamp]}`), ` - ${new Date(tournament.timestamp).toLocaleString("hu-HU")}`
                )
              )
            ) : sortedDiceGames.map((diceGame, index) =>
              React.createElement(
                "div",
                {
                  key: `dicegame-${index}`,
                  className: "bg-gray-800 bg-opacity-80 p-4 rounded-2xl border border-pink-500 glow transition-all cursor-pointer",
                  onClick: () => handleOpenModal(diceGame, "dicegame")
                },
                React.createElement("p", { className: "text-gray-400" }, 
                  React.createElement("span", { className: "text-white font-bold" }, `#${diceGameSerialMap[diceGame.timestamp]}`), ` - ${new Date(diceGame.timestamp).toLocaleString("hu-HU")}`
                )
              )
            )
          ),
          selectedTournament && React.createElement(
            "div",
            { className: "fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4" },
            React.createElement(
              "div",
              { className: "bg-gray-900 p-6 rounded-2xl w-full max-w-lg modal-content relative" },
              [
                React.createElement(
                  "button",
                  {
                    onClick: () => {
                      const isAnyEditing = Object.values(editModes).some(mode => mode === true);
                      if (isAnyEditing) {
                        alert("Kérlek, fejezd be az összes szerkesztést (✅ legyen mindenhol)!");
                        return;
                      }
                      console.log("Timestamp sent to server:", selectedTournament.timestamp);
                      console.log("PUT request data:", { matches: selectedTournament.matches });
                      fetch(`/api/tournaments/${selectedTournament.timestamp}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ matches: selectedTournament.matches })
                      }).then(response => {
                        console.log("PUT response status:", response.status);
                        if (response.ok) {
                          setTournaments(tournaments.map(t => t.timestamp === selectedTournament.timestamp ? { ...t, matches: selectedTournament.matches } : t));
                        } else {
                          console.error("PUT request failed with status:", response.status);
                        }
                      }).catch(error => console.error("PUT request error:", error));
                      handleCloseModal();
                    },
                    className: "absolute top-4 right-4 text-white text-3xl font-bold hover:text-gray-300"
                  },
                  "✖"
                ),
                React.createElement("h3", { className: "text-2xl font-bold text-white" }, `Bajnokság - ${new Date(selectedTournament.timestamp).toLocaleString("hu-HU")}`),
                React.createElement(
                  "div",
                  { className: "mt-4 space-y-6" },
                  [
                    React.createElement(
                      "div",
                      { className: "bg-gray-800 bg-opacity-80 p-4 rounded-2xl border border-pink-500" },
                      [
                        React.createElement("h4", { className: "text-lg font-bold text-white" }, "Összesített statisztika"),
                        React.createElement(
                          "div",
                          { className: "grid grid-cols-5 gap-2 text-gray-400 text-sm mt-2" },
                          [
                            React.createElement("span", { className: "font-bold" }, "Helyezés"),
                            React.createElement("span", { className: "font-bold" }, "Játékos"),
                            React.createElement("span", { className: "font-bold text-center" }, "Győzelmek"),
                            React.createElement("span", { className: "font-bold text-center" }, "Lőtt gól"),
                            React.createElement("span", { className: "font-bold text-center" }, "Kapott gól"),
                            ...calculatePlayerStats(selectedTournament.matches).map((stat, index) => [
                              React.createElement("span", { key: `stat-${index}-pos`, className: "text-pink-500 font-bold" }, `${index + 1}.`),
                              React.createElement("span", { key: `stat-${index}-name` }, stat.player ? stat.player.name : "Ismeretlen"),
                              React.createElement("span", { key: `stat-${index}-wins`, className: "text-center text-pink-500 font-bold" }, stat.wins),
                              React.createElement("span", { key: `stat-${index}-gs`, className: "text-center" }, stat.goalsScored),
                              React.createElement("span", { key: `stat-${index}-gc`, className: "text-center" }, stat.goalsConceded),
                            ]),
                          ]
                        ),
                      ]
                    ),
                    selectedTournament.matches.map((match, index) => {
                      const isEditing = editModes[index] || false;
                      const toggleEditMode = () => setEditModes(prev => ({ ...prev, [index]: !prev[index] }));
                      const handleGoalChange = (team, value) => {
                        const updatedMatches = [...selectedTournament.matches];
                        updatedMatches[index] = { ...updatedMatches[index], goals: { ...updatedMatches[index].goals, [team]: value } };
                        setSelectedTournament({ ...selectedTournament, matches: updatedMatches });
                      };

                      return React.createElement(
                        "div",
                        { key: match.id, className: "bg-gray-800 bg-opacity-80 p-4 rounded-2xl border border-pink-500" },
                        [
                          React.createElement("h4", { className: "text-gray-400 text-sm text-center font-medium" }, `#${index + 1}`),
                          React.createElement(
                            "div",
                            { className: "flex flex-col sm:flex-row justify-between items-center mt-4 space-y-4 sm:space-y-0 sm:space-x-4" },
                            [
                              React.createElement(
                                "div",
                                { className: "flex-1 min-w-0 max-w-[120px] flex flex-col items-start" },
                                [
                                  isEditing ? [
                                    React.createElement(
                                      "div",
                                      { className: "relative w-full" },
                                      [
                                        React.createElement("input", {
                                          type: "text",
                                          value: teamSearch[`${match.id}-team1Club`] || match.team1Club || "",
                                          onChange: (e) => handleTeamSearch(match.id, "team1Club", e.target.value),
                                          placeholder: "Csapat keresése...",
                                          className: "border border-gray-600 bg-gray-800 text-white p-2 rounded-2xl w-full text-sm focus:outline-none focus:ring-2 focus:ring-pink-500"
                                        }),
                                        showSuggestions[`${match.id}-team1Club`] && React.createElement(
                                          "div",
                                          { className: "absolute z-10 bg-gray-800 border border-gray-600 rounded-2xl mt-1 w-full max-h-40 overflow-y-auto" },
                                          teams
                                            .filter(team => team.toLowerCase().includes((teamSearch[`${match.id}-team1Club`] || "").toLowerCase()))
                                            .slice(0, 5)
                                            .map(team =>
                                              React.createElement(
                                                "div",
                                                {
                                                  key: `${match.id}-team1-club-${team}`,
                                                  onClick: () => selectTeam(match.id, "team1Club", team),
                                                  className: "p-2 text-white text-sm hover:bg-pink-500 cursor-pointer"
                                                },
                                                team
                                              )
                                            )
                                        ),
                                      ]
                                    ),
                                  ] : React.createElement("span", { className: "text-pink-500 font-bold" }, match.team1Club || "Nincs csapat"),
                                  React.createElement("p", { className: "text-gray-400 text-sm mt-2" }, `${match.team1[0].name} + ${match.team1[1].name}`),
                                ]
                              ),
                              React.createElement(
                                "div",
                                { className: "flex flex-col items-center" },
                                [
                                  React.createElement(
                                    "div",
                                    { className: "flex justify-center items-center" },
                                    [
                                      isEditing ? React.createElement(
                                        "input",
                                        {
                                          type: "number",
                                          value: match.goals.team1 || "",
                                          onChange: (e) => handleGoalChange("team1", e.target.value),
                                          className: "w-12 bg-gray-700 text-white rounded-lg p-1 text-center"
                                        }
                                      ) : React.createElement("span", { className: "text-white text-4xl w-20 text-center" }, match.goals.team1 || "-"),
                                      React.createElement("div", { className: "text-gray-400 font-bold mx-2 text-lg" }, "vs"),
                                      isEditing ? React.createElement(
                                        "input",
                                        {
                                          type: "number",
                                          value: match.goals.team2 || "",
                                          onChange: (e) => handleGoalChange("team2", e.target.value),
                                          className: "w-12 bg-gray-700 text-white rounded-lg p-1 text-center"
                                        }
                                      ) : React.createElement("span", { className: "text-white text-4xl w-20 text-center" }, match.goals.team2 || "-"),
                                    ]
                                  ),
                                  React.createElement(
                                    "button",
                                    { onClick: toggleEditMode, className: "text-2xl mt-2" },
                                    isEditing ? "☑️" : "✅"
                                  ),
                                ]
                              ),
                              React.createElement(
                                "div",
                                { className: "flex-1 min-w-0 max-w-[120px] flex flex-col items-end" },
                                [
                                  isEditing ? [
                                    React.createElement(
                                      "div",
                                      { className: "relative w-full" },
                                      [
                                        React.createElement("input", {
                                          type: "text",
                                          value: teamSearch[`${match.id}-team2Club`] || match.team2Club || "",
                                          onChange: (e) => handleTeamSearch(match.id, "team2Club", e.target.value),
                                          placeholder: "Csapat keresése...",
                                          className: "border border-gray-600 bg-gray-800 text-white p-2 rounded-2xl w-full text-sm focus:outline-none focus:ring-2 focus:ring-pink-500"
                                        }),
                                        showSuggestions[`${match.id}-team2Club`] && React.createElement(
                                          "div",
                                          { className: "absolute z-10 bg-gray-800 border border-gray-600 rounded-2xl mt-1 w-full max-h-40 overflow-y-auto" },
                                          teams
                                            .filter(team => team.toLowerCase().includes((teamSearch[`${match.id}-team2Club`] || "").toLowerCase()))
                                            .slice(0, 5)
                                            .map(team =>
                                              React.createElement(
                                                "div",
                                                {
                                                  key: `${match.id}-team2-club-${team}`,
                                                  onClick: () => selectTeam(match.id, "team2Club", team),
                                                  className: "p-2 text-white text-sm hover:bg-pink-500 cursor-pointer"
                                                },
                                                team
                                              )
                                            )
                                        ),
                                      ]
                                    ),
                                  ] : React.createElement("span", { className: "text-pink-500 font-bold" }, match.team2Club || "Nincs csapat"),
                                  React.createElement("p", { className: "text-gray-400 text-sm mt-2" }, `${match.team2[0].name} + ${match.team2[1].name}`),
                                ]
                              ),
                            ]
                          ),
                          match.resting && React.createElement(
                            "p",
                            { className: "text-gray-400 text-sm mt-4 text-center" },
                            `😴 Pihen: ${match.resting.name}`
                          ),
                        ]
                      );
                    }),
                  ]
                ),
              ]
            )
          ),
          selectedDiceGame && React.createElement(
            "div",
            { className: "fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4" },
            React.createElement(
              "div",
              { className: "bg-gray-900 p-6 rounded-2xl w-full max-w-lg modal-content" },
              [
                React.createElement(
                  "button",
                  {
                    onClick: handleCloseModal,
                    className: "absolute top-2 right-2 text-white text-2xl"
                  },
                  "✕"
                ),
                React.createElement("h3", { className: "text-2xl font-bold text-white" }, `Kockajáték - ${new Date(selectedDiceGame.timestamp).toLocaleString("hu-HU")}`),
                React.createElement(
                  "div",
                  { className: "mt-4 space-y-4" },
                  selectedDiceGame.results.map((result, index) => {
                    const player = players.find(p => p.id === result.playerId);
                    return React.createElement(
                      "div",
                      { key: `result-${index}`, className: "bg-gray-800 bg-opacity-80 p-4 rounded-2xl border border-pink-500" },
                      [
                        React.createElement("span", { className: "text-white font-medium" }, player ? player.name : "Ismeretlen játékos"),
                        React.createElement("span", { className: "text-gray-400 ml-4" }, `${result.position}. helyezett`),
                      ]
                    );
                  })
                ),
              ]
            )
          ),
        ]
      ),
    ]
  );
};
    
    const App = () => {
  const [players, setPlayers] = useState(initialPlayers);
  const [tournaments, setTournaments] = useState([]);
  const [diceGames, setDiceGames] = useState([]);
  const [currentPage, setCurrentPage] = useState("home");
  const [teams, setTeams] = useState(initialTeams);

  const addPlayer = (newPlayer) => {
    setPlayers([...players, newPlayer]);
  };

  const addTournament = (tournament) => {
    setTournaments([...tournaments, tournament]);
  };

  const addDiceGame = (diceGame) => {
    setDiceGames([...diceGames, diceGame]);
  };

  const addCustomTeam = (team) => {
    setTeams([...teams, team]);
  };

  useEffect(() => {
    console.log("Setting up hashchange listener");
    const handleHashChange = () => {
      try {
        const hash = window.location.hash.replace("#", "") || "home";
        console.log("Hash changed to:", hash);
        setCurrentPage(hash);
      } catch (error) {
        console.error("Error in handleHashChange:", error);
        setCurrentPage("home");
      }
    };

    handleHashChange();
    window.addEventListener("hashchange", handleHashChange);

    const fetchData = async () => {
      try {
        const tournamentResponse = await fetch('/api/tournaments');
        const diceGameResponse = await fetch('/api/diceGames');
        if (tournamentResponse.ok) {
          const tournamentsData = await tournamentResponse.json();
          setTournaments(tournamentsData);
        } else {
          console.warn("Tournament fetch failed:", tournamentResponse.status);
          setTournaments([]); // Üres tömb, ha hiba van
        }
        if (diceGameResponse.ok) {
          const diceGamesData = await diceGameResponse.json();
          setDiceGames(diceGamesData);
        } else {
          console.warn("Dice game fetch failed:", diceGameResponse.status);
          setDiceGames([]); // Üres tömb, ha hiba van
        }
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    };
    fetchData();

    return () => {
      console.log("Removing hashchange listener");
      window.removeEventListener("hashchange", handleHashChange);
    };
  }, []);

  console.log("Rendering App with currentPage:", currentPage);

  return React.createElement(
    "div",
    { className: "min-h-screen bg-gray-900" },
    [
      currentPage === "home" && React.createElement(Home, { tournaments }),
      currentPage === "players" && React.createElement(Players, { players, setPlayers, addPlayer, teams, addCustomTeam }),
      currentPage === "generate" && React.createElement(GenerateTournament, { players, addTournament, teams }),
      currentPage === "dicegame" && React.createElement(DiceGame, { players, addDiceGame }),
      currentPage === "stats" &&
        React.createElement(
          "div",
          { className: "p-4 max-w-full mx-auto fade-in page-bg" },
          [
            React.createElement(
              "div",
              { className: "bg-gray-900 bg-opacity-75 p-6 rounded-2xl" },
              [
                React.createElement("h2", { className: "text-3xl font-bold text-white" }, "Statisztika"),
                React.createElement("p", { className: "text-gray-400 mt-6 font-light" }, "Még fejlesztés alatt!"),
              ]
            ),
          ]
        ),
      currentPage === "rounds" && React.createElement(Rounds, { tournaments, diceGames, players, setTournaments }), // Hozzáadtam setTournaments
      React.createElement(NavBar, { setCurrentPage, currentPage }),
    ]
  );
};

// Renderelés
console.log("Starting render");
try {
  const root = ReactDOM.createRoot(document.getElementById("root"));
  root.render(React.createElement(App));
  console.log("Render successful");
} catch (error) {
  console.error("Render error:", error);
}
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93e1fbcbfe3544f1',t:'MTc0Njk2OTcyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
